class HeatmapChart{constructor(e){this.blogInfo={pages:e},this.init()}init(){this.initMonths(),this.createHeatmap(),this.bindEvents()}getStartDate(){const t=new Date,n=window.innerWidth<768?6:12,e=new Date(t.getFullYear(),t.getMonth()-n+1,1);for(;e.getDay()!==1;)e.setDate(e.getDate()+1);return e}initMonths(){const e=document.querySelector(".heatmap_month");if(!e)return;const o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=window.innerWidth<768?6:12,t=new Date;t.setFullYear(t.getFullYear()-1);const s=(t.getMonth()-(n-1)+12)%12;e.innerHTML="";for(let t=s;t<s+n;t++){const i=document.createElement("span"),a=t%12;i.textContent=o[a],e.appendChild(i)}}createDay(e,t,n,s){const o=document.createElement("div");return o.className="heatmap_day",o.setAttribute("data-title",t),o.setAttribute("data-count",n),o.setAttribute("data-post",s),o.setAttribute("data-date",e),this.addTooltipEvents(o),this.setDayLevel(o,n),o}addTooltipEvents(e){e.addEventListener("mouseenter",()=>{const n=document.createElement("div");n.className="heatmap_tooltip";const s=e.getAttribute("data-title"),o=e.getAttribute("data-count"),i=e.getAttribute("data-post"),a=e.getAttribute("data-date");let t="";i&&parseInt(i,10)!==0&&(t+=`<span class="heatmap_tooltip_post">共 ${i} 篇</span>`),o&&parseInt(o,10)!==0&&(t+=`<span class="heatmap_tooltip_count"> ${o} 字；</span>`),s&&!isNaN(parseInt(s,10))&&(t+=`<span class="heatmap_tooltip_title">${s}</span>`),a&&(t+=`<span class="heatmap_tooltip_date">${a}</span>`),n.innerHTML=t,e.appendChild(n)}),e.addEventListener("mouseleave",()=>{const t=e.querySelector(".heatmap_tooltip");t&&e.removeChild(t)})}setDayLevel(e,t){t=parseInt(t,10),t===0?e.classList.add("heatmap_day_level_0"):t>0&&t<1e3?e.classList.add("heatmap_day_level_1"):t>=1e3&&t<2e3?e.classList.add("heatmap_day_level_2"):t>=2e3&&t<3e3?e.classList.add("heatmap_day_level_3"):e.classList.add("heatmap_day_level_4")}createWeek(){const e=document.createElement("div");return e.className="heatmap_week",e}formatDate(e){const t={month:"short",day:"numeric",year:"numeric"};return e.toLocaleDateString("en-US",t)}createHeatmap(){const n=document.getElementById("heatmap");if(!n)return;const o=this.getStartDate(),i=new Date;n.innerHTML="";let t=this.createWeek();n.appendChild(t);let e=new Date(o),s=0;for(;e<=i;){s%7===0&&s!==0&&(t=this.createWeek(),n.appendChild(t));const i=this.formatDateString(e),o=this.blogInfo.pages.filter(e=>e.date===i);if(o.length>0){const{title:n,count:s,post:i}=this.processArticleData(o),a=this.formatDate(e),r=this.createDay(a,n,s,i);t.appendChild(r)}else{const n=this.formatDate(e),s=this.createDay(n,"","0","0");t.appendChild(s)}s++,e.setDate(e.getDate()+1)}}formatDateString(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}processArticleData(e){const n=e.map(e=>e.title),s=n.map(e=>`《${e}》`).join("<br />");let t=0,o=e.length;return e.forEach(e=>{t+=parseInt(e.word_count,10)}),{title:s,count:t,post:o}}bindEvents(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.initMonths(),this.createHeatmap()},250)})}}window.HeatmapChart=HeatmapChart